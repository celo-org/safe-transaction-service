name: Docker Build Push
on:
  workflow_dispatch:
  push:
    branches:
      - 'feat/celo'
  pull_request:

jobs:
  Build-Container-dev:
    uses: celo-org/reusable-workflows/.github/workflows/container-cicd-trivy.yaml@968d632cd8dbf70cd3cc1b6aa15316bd1144699d
    if: github.ref != 'refs/heads/feat/celo'
    with:
      workload-id-provider: ${{ vars.WORKLOAD_ID_PROVIDER_NON_PROD }}
      service-account:  'safe-tx-service-images-dev@devopsre.iam.gserviceaccount.com'
      artifact-registry: ${{ vars.DEV_IMAGE_REPO }}/safe-transaction-service
      tag: testing
      context: .


  Build-Container:
   uses: celo-org/reusable-workflows/.github/workflows/container-cicd-trivy.yaml@968d632cd8dbf70cd3cc1b6aa15316bd1144699d
   if: github.ref == 'refs/heads/feat/celo'
   with:
      workload-id-provider: ${{ vars.WORKLOAD_ID_PROVIDER_PROD }}
      service-account:  'safe-tx-service-images@devopsre.iam.gserviceaccount.com'
      artifact-registry: ${{ vars.SAFE_TRANSACTION_SERVICE_IMAGE_REPO }}/safe-transaction-service
      tag: latest
      context: .
